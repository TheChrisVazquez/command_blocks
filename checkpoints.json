// Comando para establecer el checkpoint cuando pasa por un jugador
//Always
/execute as @a at @s if entity @s[x=34,y=-59,z=-13,dx=0,dy=0,dz=0] run data merge entity @s {Checkpoint:{X:34,Y:-59,Z:-13}}
// Este funciona
/execute as @a at @s if entity @s[x=34,y=-59,z=-13,dx=1,dy=1,dz=1] run tellraw @s {"text":"Checkpoint guardado.","color":"blue"}
/execute as @a at @s if entity @s[x=34,y=-59,z=-13,dx=1,dy=1,dz=1] run data merge entity @s {Checkpoint:{X:34,Y:-59,Z:-13}}


/execute as @a[nbt={Checkpoint:{X:34,Y:-59,Z:-13}}] run tellraw @s {"text":"¡Checkpoint establecido!","color":"green"}

/execute as @a[nbt={Checkpoint:{X:34,Y:-59,Z:200}}] run tellraw @s {"text":"Checkpoint guardado.","color":"blue"}
/execute as @a at @s if entity @s[distance=..1.5] positioned 34.438 -59 -13.4 run data merge entity @s {Checkpoint:{X:34.438,Y:-59,Z:-13.4}}


// Se crean scoreboards
/scoreboard objectives add CheckpointX dummy
/scoreboard objectives add CheckpointY dummy
/scoreboard objectives add CheckpointZ dummy

/execute as @a at @s if entity @s[x=34,y=-59,z=-13,dx=0,dy=1,dz=0] run scoreboard players set @s CheckpointX 34
/execute as @a at @s if entity @s[x=34,y=-59,z=-13,dx=0,dy=1,dz=0] run scoreboard players set @s CheckpointY -59
/execute as @a at @s if entity @s[x=34,y=-59,z=-13,dx=0,dy=1,dz=0] run scoreboard players set @s CheckpointZ -13

/execute as @a[scores={LastCheckpoint=0}] at @s if entity @s[x=34,y=-59,z=-13,dx=0,dy=1,dz=0] run scoreboard players set @s CheckpointX 34
/execute as @a[scores={LastCheckpoint=0}] at @s if entity @s[x=34,y=-59,z=-13,dx=0,dy=1,dz=0] run scoreboard players set @s CheckpointY -59
/execute as @a[scores={LastCheckpoint=0}] at @s if entity @s[x=34,y=-59,z=-13,dx=0,dy=1,dz=0] run scoreboard players set @s CheckpointZ -13

/scoreboard objectives add LastCheckpoint dummy
/scoreboard players set @s LastCheckpoint 0

/execute as @a[scores={CheckpointX=34,CheckpointY=-59,CheckpointZ=-13}] run tellraw @s {"text":"¡Checkpoint establecido!","color":"green"}
/execute as @a[scores={CheckpointX=34,CheckpointY=-59,CheckpointZ=-13, LastCheckpoint=0}] run scoreboard players set @s LastCheckpoint 1
/execute as @a[scores={CheckpointX=34,CheckpointY=-59,CheckpointZ=-13, LastCheckpoint=0}] run scoreboard players set @s LastCheckpoint 1


/scoreboard players set @s LastCheckpoint 1

/execute as @a store result score @s CheckpointX
// Para ver la lista
/scoreboard players get TheChrisVazquez LastCheckpoint

/summon armor_stand ~ ~ ~ {Tags:["CheckpointMarker"],Invisible:1b,NoGravity:1b}
/execute as @e[tag=CheckpointMarker] store result entity @s Pos[0] double 1 run scoreboard players get @p CheckpointX
/execute as @e[tag=CheckpointMarker] store result entity @s Pos[1] double 1 run scoreboard players get @p CheckpointY
/execute as @e[tag=CheckpointMarker] store result entity @s Pos[2] double 1 run scoreboard players get @p CheckpointZ

/execute as @p at @s run tp @s @e[tag=CheckpointMarker,limit=1]
